<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Kritik's Gurkha Gains</title>
    <meta name="description" content="Premium PPL Workout Tracker with Progressive Overload & PR Tracking">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Gurkha Gains">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --gold-light: #F4CF67;
            --gold-dark: #AA8C2C;
            --black: #000000;
            --dark: #0A0A0A;
            --dark-card: #141414;
            --dark-border: #222222;
            --gray-900: #1a1a1a;
            --gray-800: #262626;
            --gray-700: #333333;
            --gray-600: #444444;
            --gray-500: #666666;
            --gray-400: #888888;
            --gray-300: #aaaaaa;
            --white: #ffffff;
            --green: #22C55E;
            --green-dark: #16A34A;
            --red: #EF4444;
            --blue: #3B82F6;
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body { 
            font-family: 'Inter', sans-serif;
            background: var(--black);
            min-height: 100vh;
            color: var(--white);
            overflow-x: hidden;
        }
        
        .app-container { 
            max-width: 430px; 
            margin: 0 auto; 
            min-height: 100vh; 
            position: relative;
            background: var(--dark);
        }
        
        /* Header */
        .header {
            background: var(--black);
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 50;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }
        
        .brand {
            flex: 1;
        }
        
        .brand-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.4rem;
            letter-spacing: 2px;
            color: var(--white);
        }
        
        .brand-name span {
            color: var(--gold);
        }
        
        .date-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--gray-400);
            margin-top: 2px;
        }
        
        .nepali-date {
            color: var(--gold);
        }
        
        /* Navigation */
        .nav {
            display: flex;
            background: var(--black);
            border-bottom: 1px solid var(--dark-border);
            position: sticky;
            top: 77px;
            z-index: 40;
        }
        
        .nav-btn {
            flex: 1;
            padding: 14px 8px;
            background: transparent;
            border: none;
            color: var(--gray-500);
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .nav-btn.active {
            color: var(--gold);
        }
        
        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            right: 20%;
            height: 2px;
            background: var(--gold);
        }
        
        /* Day Selector */
        .day-selector {
            display: flex;
            gap: 8px;
            padding: 16px;
            overflow-x: auto;
            scrollbar-width: none;
            background: var(--dark);
        }
        
        .day-selector::-webkit-scrollbar { display: none; }
        
        .day-chip {
            flex-shrink: 0;
            width: 52px;
            padding: 12px 8px;
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .day-chip:hover {
            border-color: var(--gray-600);
        }
        
        .day-chip.active {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            border-color: var(--gold);
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
        }
        
        .day-chip.active .day-number,
        .day-chip.active .day-name,
        .day-chip.active .day-nepali {
            color: var(--black);
        }
        
        .day-chip.today:not(.active) {
            border-color: var(--green);
            box-shadow: 0 0 0 1px var(--green);
        }
        
        .day-number {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            color: var(--white);
            line-height: 1;
        }
        
        .day-name {
            font-size: 0.55rem;
            color: var(--gray-500);
            margin-top: 4px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .day-nepali {
            font-size: 0.55rem;
            color: var(--gold);
            margin-top: 2px;
        }
        
        /* Quick Stats Bar */
        .quick-stats {
            display: flex;
            gap: 8px;
            padding: 0 16px 12px;
            background: var(--dark);
        }
        
        .quick-stat {
            flex: 1;
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }
        
        .quick-stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            color: var(--white);
        }
        
        .quick-stat-label {
            font-size: 0.55rem;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .quick-stat.gold .quick-stat-value { color: var(--gold); }
        .quick-stat.green .quick-stat-value { color: var(--green); }
        
        /* Creatine Card */
        .creatine-card {
            margin: 0 16px 12px;
            padding: 14px 16px;
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .creatine-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .creatine-icon {
            width: 40px;
            height: 40px;
            background: var(--gray-800);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .creatine-text h4 {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--white);
        }
        
        .creatine-text p {
            font-size: 0.65rem;
            color: var(--gray-500);
        }
        
        .creatine-btn {
            padding: 10px 18px;
            border-radius: 8px;
            border: 1px solid var(--gray-600);
            background: transparent;
            color: var(--gray-400);
            font-family: 'Inter', sans-serif;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }
        
        .creatine-btn.taken {
            background: var(--green);
            border-color: var(--green);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
        }
        
        /* Workout Header */
        .workout-header {
            margin: 0 16px 16px;
            padding: 20px;
            background: linear-gradient(135deg, var(--gray-900) 0%, var(--dark-card) 100%);
            border: 1px solid var(--dark-border);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .workout-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold), var(--gold-light), var(--gold));
        }
        
        .workout-meta {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .workout-day-label {
            font-size: 0.65rem;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 4px;
        }
        
        .workout-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.6rem;
            color: var(--white);
            letter-spacing: 1px;
        }
        
        .workout-focus {
            font-size: 0.75rem;
            color: var(--gray-400);
            margin-top: 4px;
        }
        
        /* Progress Ring */
        .progress-container {
            position: relative;
            width: 70px;
            height: 70px;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-bg { 
            stroke: var(--gray-800); 
        }
        
        .progress-ring-fill {
            stroke: var(--gold);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
            filter: drop-shadow(0 0 6px rgba(212, 175, 55, 0.5));
        }
        
        .progress-text {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .progress-percent {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            color: var(--white);
        }
        
        /* Weight Unit Toggle */
        .unit-toggle {
            margin: 0 16px 12px;
            padding: 12px 16px;
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .unit-label {
            font-size: 0.75rem;
            color: var(--gray-400);
            font-weight: 500;
        }
        
        .unit-buttons {
            display: flex;
            background: var(--gray-800);
            border-radius: 8px;
            padding: 3px;
        }
        
        .unit-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--gray-500);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .unit-btn.active {
            background: var(--gold);
            color: var(--black);
        }
        
        /* Exercise List */
        .exercise-list {
            padding: 0 16px 120px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .exercise-card {
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 14px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        
        .exercise-card.completed {
            border-color: var(--green);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, var(--dark-card) 100%);
        }
        
        .exercise-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .exercise-info {
            flex: 1;
        }
        
        .muscle-tag {
            display: inline-block;
            padding: 3px 8px;
            background: var(--gray-800);
            border-radius: 4px;
            font-size: 0.55rem;
            font-weight: 700;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }
        
        .exercise-name {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--white);
            line-height: 1.3;
        }
        
        .exercise-note {
            font-size: 0.65rem;
            color: var(--gray-500);
            margin-top: 3px;
        }
        
        /* PR Badge */
        .pr-badge {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            border-radius: 6px;
            font-size: 0.6rem;
            font-weight: 700;
            color: var(--black);
        }
        
        .pr-badge.no-pr {
            background: var(--gray-800);
            color: var(--gray-500);
        }
        
        /* Sets Grid */
        .sets-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .set-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--gray-800);
            border-radius: 8px;
            border: 1px solid var(--gray-700);
        }
        
        .set-checkbox {
            appearance: none;
            width: 22px;
            height: 22px;
            border: 2px solid var(--gray-600);
            border-radius: 6px;
            background: transparent;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .set-checkbox:checked {
            background: var(--green);
            border-color: var(--green);
        }
        
        .set-checkbox:checked::after {
            content: '‚úì';
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: bold;
            font-size: 12px;
        }
        
        .set-info {
            text-align: left;
        }
        
        .set-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--white);
        }
        
        .set-reps {
            font-size: 0.55rem;
            color: var(--gray-500);
        }
        
        /* Weight Controls */
        .weight-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 12px;
            border-top: 1px solid var(--gray-800);
        }
        
        .weight-label {
            font-size: 0.7rem;
            color: var(--gray-500);
            font-weight: 500;
        }
        
        .weight-controls {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .weight-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px solid var(--gray-700);
            background: var(--gray-800);
            color: var(--white);
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .weight-btn:hover {
            background: var(--gray-700);
            border-color: var(--gold);
        }
        
        .weight-btn:active {
            transform: scale(0.95);
        }
        
        .weight-display {
            min-width: 70px;
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gold);
            padding: 6px 12px;
            background: var(--gray-900);
            border-radius: 6px;
        }
        
        /* Progressive Overload Indicator */
        .overload-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
            padding: 8px 12px;
            background: var(--gray-900);
            border-radius: 8px;
            font-size: 0.65rem;
        }
        
        .overload-indicator.up {
            color: var(--green);
        }
        
        .overload-indicator.same {
            color: var(--gray-500);
        }
        
        .overload-indicator.down {
            color: var(--red);
        }
        
        /* Calendar View */
        .calendar-container {
            margin: 16px;
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 16px;
            padding: 20px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-nav-btn {
            width: 40px;
            height: 40px;
            background: var(--gray-800);
            border: 1px solid var(--gray-700);
            border-radius: 10px;
            color: var(--white);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calendar-nav-btn:hover {
            background: var(--gray-700);
            border-color: var(--gold);
        }
        
        .calendar-title {
            text-align: center;
        }
        
        .calendar-month {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            color: var(--white);
            letter-spacing: 1px;
        }
        
        .calendar-nepali-month {
            font-size: 0.75rem;
            color: var(--gold);
            margin-top: 2px;
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }
        
        .calendar-weekday {
            font-size: 0.6rem;
            color: var(--gray-500);
            text-align: center;
            padding: 8px 0;
            font-weight: 600;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            background: var(--gray-900);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .calendar-day:hover {
            background: var(--gray-800);
        }
        
        .calendar-day.today {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            font-weight: 700;
        }
        
        .calendar-day.completed-day {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid var(--green);
        }
        
        .calendar-day.holiday {
            color: var(--red);
        }
        
        .calendar-day.holiday::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 4px;
            height: 4px;
            background: var(--red);
            border-radius: 50%;
        }
        
        /* Holiday List */
        .holiday-card {
            margin: 0 16px 16px;
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .holiday-card-header {
            padding: 12px 16px;
            background: var(--gray-900);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gold);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .holiday-list {
            padding: 8px 0;
        }
        
        .holiday-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 16px;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .holiday-item:last-child {
            border-bottom: none;
        }
        
        .holiday-name {
            font-size: 0.8rem;
            color: var(--white);
        }
        
        .holiday-name span {
            color: var(--gray-500);
            font-size: 0.7rem;
        }
        
        .holiday-type {
            font-size: 0.6rem;
            padding: 3px 8px;
            border-radius: 4px;
            background: var(--gray-800);
            color: var(--gray-400);
        }
        
        .holiday-type.nepal {
            background: rgba(212, 175, 55, 0.2);
            color: var(--gold);
        }
        
        /* Stats View */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 16px;
        }
        
        .stat-card {
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 14px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }
        
        .stat-card.gold::before { background: var(--gold); }
        .stat-card.green::before { background: var(--green); }
        .stat-card.blue::before { background: var(--blue); }
        .stat-card.red::before { background: var(--red); }
        
        .stat-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.2rem;
            line-height: 1;
        }
        
        .stat-card.gold .stat-value { color: var(--gold); }
        .stat-card.green .stat-value { color: var(--green); }
        .stat-card.blue .stat-value { color: var(--blue); }
        .stat-card.red .stat-value { color: var(--red); }
        
        .stat-label {
            font-size: 0.65rem;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 4px;
        }
        
        /* Weekly Overview */
        .weekly-card {
            margin: 0 16px 16px;
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 14px;
            padding: 20px;
        }
        
        .weekly-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .weekly-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            color: var(--white);
            letter-spacing: 1px;
        }
        
        .weekly-days {
            display: flex;
            justify-content: space-between;
        }
        
        .weekly-day {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }
        
        .weekly-day-box {
            width: 36px;
            height: 36px;
            background: var(--gray-800);
            border: 1px solid var(--gray-700);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: var(--gray-500);
            transition: all 0.3s;
        }
        
        .weekly-day-box.completed {
            background: var(--green);
            border-color: var(--green);
            color: var(--white);
        }
        
        .weekly-day-label {
            font-size: 0.55rem;
            color: var(--gray-500);
        }
        
        /* PR Records Section */
        .pr-section {
            margin: 0 16px 16px;
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 14px;
            overflow: hidden;
        }
        
        .pr-header {
            padding: 16px;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pr-list {
            padding: 8px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .pr-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .pr-item:last-child {
            border-bottom: none;
        }
        
        .pr-exercise {
            font-size: 0.8rem;
            color: var(--white);
        }
        
        .pr-weight {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gold);
        }
        
        /* Data Management Buttons */
        .data-buttons {
            display: flex;
            gap: 12px;
            padding: 0 16px 16px;
        }
        
        .data-btn {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .data-btn.export {
            background: var(--gold);
            border: none;
            color: var(--black);
        }
        
        .data-btn.export:hover {
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.4);
        }
        
        .data-btn.import {
            background: transparent;
            border: 1px solid var(--gray-600);
            color: var(--gray-400);
        }
        
        .data-btn.import:hover {
            border-color: var(--gold);
            color: var(--gold);
        }
        
        .reset-btn {
            margin: 0 16px 100px;
            width: calc(100% - 32px);
            padding: 14px;
            background: transparent;
            border: 1px solid var(--red);
            border-radius: 12px;
            color: var(--red);
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .reset-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        /* Level Bar */
        .level-card {
            margin: 0 16px 12px;
            padding: 14px 16px;
            background: var(--dark-card);
            border: 1px solid var(--dark-border);
            border-radius: 12px;
        }
        
        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .level-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .level-badge {
            padding: 4px 10px;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            border-radius: 6px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            color: var(--black);
        }
        
        .level-title {
            font-size: 0.75rem;
            color: var(--gray-400);
        }
        
        .level-xp {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--gray-500);
        }
        
        .level-bar {
            height: 6px;
            background: var(--gray-800);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .level-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--gold-light));
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        /* Install Banner */
        .install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            padding: 14px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        
        .install-banner.show {
            transform: translateY(0);
        }
        
        .install-banner.hidden { 
            display: none; 
        }
        
        .install-text {
            color: var(--black);
        }
        
        .install-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
        }
        
        .install-subtitle {
            font-size: 0.65rem;
            opacity: 0.8;
        }
        
        .install-buttons {
            display: flex;
            gap: 8px;
        }
        
        .install-btn {
            padding: 8px 16px;
            background: var(--black);
            color: var(--gold);
            border: none;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        .install-dismiss {
            padding: 8px;
            background: none;
            border: none;
            color: var(--black);
            font-size: 1rem;
            cursor: pointer;
            opacity: 0.7;
        }
        
        /* Hidden file input */
        .hidden-input {
            display: none;
        }
        
        /* Utility */
        .hidden { display: none !important; }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--gray-800);
            color: var(--white);
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            z-index: 200;
            opacity: 0;
            transition: all 0.3s ease;
            border: 1px solid var(--gray-700);
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            border-color: var(--green);
        }
        
        .toast.error {
            border-color: var(--red);
        }
    </style>
</head>
<body>
    <!-- Toast -->
    <div id="toast" class="toast"></div>
    
    <!-- Install Banner -->
    <div id="installBanner" class="install-banner hidden">
        <div class="install-text">
            <div class="install-title">INSTALL GURKHA GAINS</div>
            <div class="install-subtitle">Add to home screen for best experience</div>
        </div>
        <div class="install-buttons">
            <button onclick="dismissInstall()" class="install-dismiss">‚úï</button>
            <button onclick="installApp()" class="install-btn">INSTALL</button>
        </div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo-container">
                <div class="logo">üèãÔ∏è</div>
                <div class="brand">
                    <h1 class="brand-name">KRITIK'S <span>GURKHA GAINS</span></h1>
                    <p class="date-display">
                        <span id="englishDate"></span> ‚Ä¢ <span class="nepali-date" id="nepaliDate">Loading...</span>
                    </p>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <button onclick="showView('workout')" class="nav-btn active" id="nav-workout">üí™ Workout</button>
            <button onclick="showView('calendar')" class="nav-btn" id="nav-calendar">üìÖ ‡§™‡§æ‡§§‡•ç‡§∞‡•ã</button>
            <button onclick="showView('stats')" class="nav-btn" id="nav-stats">üìä Stats</button>
        </nav>

        <!-- Workout View -->
        <div id="workout-view">
            <!-- Day Selector -->
            <div class="day-selector" id="dayTabs"></div>

            <!-- Quick Stats -->
            <div class="quick-stats">
                <div class="quick-stat gold">
                    <div class="quick-stat-value" id="todaySets">0/0</div>
                    <div class="quick-stat-label">Sets Done</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-value" id="todayExercises">0/0</div>
                    <div class="quick-stat-label">Exercises</div>
                </div>
                <div class="quick-stat green">
                    <div class="quick-stat-value" id="streakCount">0üî•</div>
                    <div class="quick-stat-label">Streak</div>
                </div>
            </div>

            <!-- Creatine Tracker -->
            <div class="creatine-card">
                <div class="creatine-info">
                    <div class="creatine-icon">üíä</div>
                    <div class="creatine-text">
                        <h4>Daily Creatine</h4>
                        <p>5g Monohydrate ‚Ä¢ ‡§Ü‡§ú ‡§≤‡§ø‡§Ø‡•ã?</p>
                    </div>
                </div>
                <button id="creatineBtn" class="creatine-btn" onclick="toggleCreatine()">NOT TAKEN</button>
            </div>

            <!-- Level/XP Bar -->
            <div class="level-card">
                <div class="level-header">
                    <div class="level-info">
                        <div class="level-badge">LVL <span id="userLevel">1</span></div>
                        <span class="level-title">Warrior ‡§Ø‡•ã‡§¶‡•ç‡§ß‡§æ</span>
                    </div>
                    <span class="level-xp"><span id="currentXP">0</span>/<span id="nextLevelXP">100</span> XP</span>
                </div>
                <div class="level-bar">
                    <div class="level-fill" id="xpFill" style="width: 0%;"></div>
                </div>
            </div>

            <!-- Weight Unit Toggle -->
            <div class="unit-toggle">
                <span class="unit-label">Weight Unit</span>
                <div class="unit-buttons">
                    <button class="unit-btn active" id="unitLbs" onclick="setWeightUnit('lbs')">LBS</button>
                    <button class="unit-btn" id="unitKg" onclick="setWeightUnit('kg')">KG</button>
                </div>
            </div>

            <!-- Workout Header -->
            <div class="workout-header">
                <div class="workout-meta">
                    <div>
                        <p class="workout-day-label" id="workoutDayLabel">Day 1 ‚Ä¢ ‡§Ü‡§á‡§§‡§¨‡§æ‡§∞</p>
                        <h2 class="workout-title" id="currentDayTitle">PUSH A</h2>
                        <p class="workout-focus" id="currentDayFocus">Heavy Press & Triceps</p>
                    </div>
                    <div class="progress-container">
                        <svg class="progress-ring" width="70" height="70">
                            <circle class="progress-ring-bg" cx="35" cy="35" r="30" stroke-width="5" fill="none"/>
                            <circle class="progress-ring-fill" id="progressCircle" cx="35" cy="35" r="30" stroke-width="5" fill="none" stroke-dasharray="188.5" stroke-dashoffset="188.5"/>
                        </svg>
                        <div class="progress-text">
                            <span class="progress-percent" id="progressText">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Exercise List -->
            <div class="exercise-list" id="exerciseList"></div>
        </div>

        <!-- Calendar View -->
        <div id="calendar-view" class="hidden">
            <div class="calendar-container">
                <div class="calendar-header">
                    <button onclick="changeMonth(-1)" class="calendar-nav-btn">‚óÄ</button>
                    <div class="calendar-title">
                        <div class="calendar-month" id="calendarMonth"></div>
                        <div class="calendar-nepali-month" id="calendarNepaliMonth"></div>
                    </div>
                    <button onclick="changeMonth(1)" class="calendar-nav-btn">‚ñ∂</button>
                </div>
                <div class="calendar-weekdays">
                    <div class="calendar-weekday">‡§Ü‡§á‡§§</div>
                    <div class="calendar-weekday">‡§∏‡•ã‡§Æ</div>
                    <div class="calendar-weekday">‡§Æ‡§Ç‡§ó‡§≤</div>
                    <div class="calendar-weekday">‡§¨‡•Å‡§ß</div>
                    <div class="calendar-weekday">‡§¨‡§ø‡§π‡•Ä</div>
                    <div class="calendar-weekday">‡§∂‡•Å‡§ï‡•ç‡§∞</div>
                    <div class="calendar-weekday">‡§∂‡§®‡§ø</div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
            
            <div class="holiday-card" id="holidayCard">
                <div class="holiday-card-header">üéâ Holidays This Month</div>
                <div class="holiday-list" id="holidayList"></div>
            </div>
        </div>

        <!-- Stats View -->
        <div id="stats-view" class="hidden">
            <div class="stats-grid">
                <div class="stat-card gold">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-value" id="totalWorkouts">0</div>
                    <div class="stat-label">Workouts</div>
                </div>
                <div class="stat-card green">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-value" id="currentStreak">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
                <div class="stat-card blue">
                    <div class="stat-icon">üí™</div>
                    <div class="stat-value" id="totalSets">0</div>
                    <div class="stat-label">Total Sets</div>
                </div>
                <div class="stat-card red">
                    <div class="stat-icon">üíä</div>
                    <div class="stat-value" id="creatineDays">0</div>
                    <div class="stat-label">Creatine Days</div>
                </div>
            </div>

            <!-- Weekly Overview -->
            <div class="weekly-card">
                <div class="weekly-header">
                    <span class="weekly-title">THIS WEEK'S PROGRESS</span>
                </div>
                <div class="weekly-days" id="weeklyDays"></div>
            </div>

            <!-- PR Records -->
            <div class="pr-section">
                <div class="pr-header">üèÖ PERSONAL RECORDS (PRs)</div>
                <div class="pr-list" id="prList">
                    <div class="pr-item">
                        <span class="pr-exercise">No PRs yet. Start lifting!</span>
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div class="data-buttons">
                <button onclick="exportData()" class="data-btn export">üì§ Export</button>
                <button onclick="document.getElementById('importInput').click()" class="data-btn import">üì• Import</button>
                <input type="file" id="importInput" class="hidden-input" accept=".json" onchange="importData(event)">
            </div>

            <button onclick="resetAllData()" class="reset-btn">‚ö†Ô∏è Reset All Data</button>
        </div>
    </div>

    <script>
        // Workout Data with Forearms
        const workoutData = {
            1: { 
                title: "PUSH A", 
                nepaliDay: "‡§Ü‡§á‡§§‡§¨‡§æ‡§∞",
                focus: "Heavy Press & Triceps", 
                exercises: [
                    { name: "Inclined Smith Machine Chest Press", sets: 3, reps: "8-10", note: "Heavy compound", muscle: "CHEST", trackWeight: true },
                    { name: "Dips", sets: 3, reps: "10-12", note: "Lower chest/triceps", muscle: "CHEST", trackWeight: true },
                    { name: "Chest Fly Machine", sets: 3, reps: "12-15", note: "Peak contraction", muscle: "CHEST", trackWeight: true },
                    { name: "Cable Lateral Raises", sets: 4, reps: "12-15", note: "Constant tension", muscle: "DELTS", trackWeight: true },
                    { name: "Cable Tricep Push Downs", sets: 3, reps: "10-12", note: "Rope or straight bar", muscle: "TRICEPS", trackWeight: true },
                    { name: "EZ Bar Skull Crushers", sets: 3, reps: "8-10", note: "Long head focus", muscle: "TRICEPS", trackWeight: true }
                ]
            },
            2: { 
                title: "PULL A", 
                nepaliDay: "‡§∏‡•ã‡§Æ‡§¨‡§æ‡§∞",
                focus: "Vertical Pull & Forearm Width", 
                exercises: [
                    { name: "Pull Ups", sets: 3, reps: "AMRAP", note: "Add weight if needed", muscle: "BACK", trackWeight: true },
                    { name: "Lat Pulldowns", sets: 3, reps: "10-12", note: "Wide grip", muscle: "LATS", trackWeight: true },
                    { name: "Lat Prayers", sets: 3, reps: "12-15", note: "Straight arm pulldowns", muscle: "LATS", trackWeight: true },
                    { name: "Seated Chest Supported Rows", sets: 3, reps: "10-12", note: "Upper back thickness", muscle: "BACK", trackWeight: true },
                    { name: "Bayesian Bicep Curls", sets: 3, reps: "12-15", note: "Full stretch", muscle: "BICEPS", trackWeight: true },
                    { name: "Preacher Bicep Curls", sets: 3, reps: "10-12", note: "Short head isolation", muscle: "BICEPS", trackWeight: true },
                    { name: "Reverse Cable Curls", sets: 3, reps: "12-15", note: "Extensors & Brachioradialis", muscle: "FOREARMS", trackWeight: true }
                ]
            },
            3: { 
                title: "LEGS A", 
                nepaliDay: "‡§Æ‡§Ç‡§ó‡§≤‡§¨‡§æ‡§∞",
                focus: "Squat Focus + Lower Abs", 
                exercises: [
                    { name: "Squats", sets: 3, reps: "6-8", note: "Primary compound", muscle: "QUADS", trackWeight: true },
                    { name: "Hip Thrust Machine", sets: 3, reps: "10-12", note: "Glute focus", muscle: "GLUTES", trackWeight: true },
                    { name: "Quad Leg Extensions", sets: 3, reps: "12-15", note: "Isolation", muscle: "QUADS", trackWeight: true },
                    { name: "Seated Calf Raises", sets: 4, reps: "15-20", note: "Full ROM", muscle: "CALVES", trackWeight: true },
                    { name: "Leg Raises", sets: 3, reps: "15", note: "Lower abs", muscle: "ABS", trackWeight: false },
                    { name: "Inclined Treadmill Walk", sets: 1, reps: "20-30 min", note: "Cardio", muscle: "CARDIO", trackWeight: false }
                ]
            },
            4: { 
                title: "PUSH B", 
                nepaliDay: "‡§¨‡•Å‡§ß‡§¨‡§æ‡§∞",
                focus: "Volume & Shoulder Detail", 
                exercises: [
                    { name: "Hammer Chest Press", sets: 3, reps: "8-10", note: "Flat press", muscle: "CHEST", trackWeight: true },
                    { name: "Inclined Machine Press", sets: 3, reps: "10-12", note: "Upper pec", muscle: "CHEST", trackWeight: true },
                    { name: "Multiflight Lateral Raise Machine", sets: 4, reps: "12-15", note: "Drop sets work well", muscle: "DELTS", trackWeight: true },
                    { name: "Inclined Y Raises", sets: 3, reps: "12-15", note: "Lower traps/rear delts", muscle: "DELTS", trackWeight: true },
                    { name: "Cable Tricep Extension (Overhead)", sets: 3, reps: "12-15", note: "Long head stretch", muscle: "TRICEPS", trackWeight: true }
                ]
            },
            5: { 
                title: "PULL B", 
                nepaliDay: "‡§¨‡§ø‡§π‡•Ä‡§¨‡§æ‡§∞",
                focus: "Row Focus & Grip Strength", 
                exercises: [
                    { name: "Seated Cable Rows", sets: 3, reps: "10-12", note: "Squeeze contraction", muscle: "BACK", trackWeight: true },
                    { name: "Inclined DB Chest Supported Rows", sets: 3, reps: "10-12", note: "No lower back strain", muscle: "BACK", trackWeight: true },
                    { name: "Lat Pulldowns (Neutral Grip)", sets: 3, reps: "10-12", note: "Close grip", muscle: "LATS", trackWeight: true },
                    { name: "Preacher Hammer Curls", sets: 3, reps: "10-12", note: "Brachialis focus", muscle: "BICEPS", trackWeight: true },
                    { name: "Bayesian Bicep Curls", sets: 2, reps: "15", note: "Pump finisher", muscle: "BICEPS", trackWeight: true },
                    { name: "Behind-the-Back Barbell Wrist Curls", sets: 3, reps: "15-20", note: "Inner forearm flexors", muscle: "FOREARMS", trackWeight: true }
                ]
            },
            6: { 
                title: "LEGS B", 
                nepaliDay: "‡§∂‡•Å‡§ï‡•ç‡§∞‡§¨‡§æ‡§∞",
                focus: "Deadlift Focus + Upper Abs", 
                exercises: [
                    { name: "Deadlifts", sets: 3, reps: "5-8", note: "Heavy - strict form", muscle: "POSTERIOR", trackWeight: true },
                    { name: "Lying Hamstring Curls", sets: 3, reps: "10-12", note: "Isolation", muscle: "HAMSTRINGS", trackWeight: true },
                    { name: "Quad Leg Extensions", sets: 3, reps: "12-15", note: "Maintain quad volume", muscle: "QUADS", trackWeight: true },
                    { name: "Seated Calf Raises", sets: 4, reps: "15-20", note: "Full ROM", muscle: "CALVES", trackWeight: true },
                    { name: "Cable Crunches", sets: 3, reps: "15", note: "Upper abs", muscle: "ABS", trackWeight: true },
                    { name: "Elliptical Machine", sets: 1, reps: "20-30 min", note: "Cardio", muscle: "CARDIO", trackWeight: false }
                ]
            },
            7: { 
                title: "REST DAY", 
                nepaliDay: "‡§∂‡§®‡§ø‡§¨‡§æ‡§∞",
                focus: "Active Recovery", 
                exercises: [
                    { name: "Light Walking", sets: 1, reps: "30-45 min", note: "Active recovery", muscle: "RECOVERY", trackWeight: false },
                    { name: "Foam Rolling", sets: 1, reps: "15-20 min", note: "Full body", muscle: "MOBILITY", trackWeight: false },
                    { name: "Stretching", sets: 1, reps: "15-20 min", note: "Focus on tight areas", muscle: "MOBILITY", trackWeight: false }
                ]
            }
        };

        // Nepali Calendar Data
        const nepaliMonths = ["‡§¨‡•à‡§∂‡§æ‡§ñ", "‡§ú‡•á‡§†", "‡§Ö‡§∏‡§æ‡§∞", "‡§∂‡•ç‡§∞‡§æ‡§µ‡§£", "‡§≠‡§¶‡•å", "‡§Ö‡§∏‡•ã‡§ú", "‡§ï‡§æ‡§∞‡•ç‡§§‡§ø‡§ï", "‡§Æ‡§Ç‡§∏‡§ø‡§∞", "‡§™‡•Å‡§∑", "‡§Æ‡§æ‡§ò", "‡§´‡§æ‡§≤‡•ç‡§ó‡•Å‡§®", "‡§ö‡•à‡§§‡•ç‡§∞"];
        const nepaliMonthsEng = ["Baisakh", "Jestha", "Ashar", "Shrawan", "Bhadra", "Ashwin", "Kartik", "Mangsir", "Poush", "Magh", "Falgun", "Chaitra"];
        const nepaliNums = ["‡•¶", "‡•ß", "‡•®", "‡•©", "‡•™", "‡•´", "‡•¨", "‡•≠", "‡•Æ", "‡•Ø"];
        const shortDayNames = ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"];
        const nepaliDayNames = ["‡§Ü‡§á‡§§", "‡§∏‡•ã‡§Æ", "‡§Æ‡§Ç‡§ó‡§≤", "‡§¨‡•Å‡§ß", "‡§¨‡§ø‡§π‡•Ä", "‡§∂‡•Å‡§ï‡•ç‡§∞", "‡§∂‡§®‡§ø"];
        const nepaliDayNamesFull = ["‡§Ü‡§á‡§§‡§¨‡§æ‡§∞", "‡§∏‡•ã‡§Æ‡§¨‡§æ‡§∞", "‡§Æ‡§Ç‡§ó‡§≤‡§¨‡§æ‡§∞", "‡§¨‡•Å‡§ß‡§¨‡§æ‡§∞", "‡§¨‡§ø‡§π‡•Ä‡§¨‡§æ‡§∞", "‡§∂‡•Å‡§ï‡•ç‡§∞‡§¨‡§æ‡§∞", "‡§∂‡§®‡§ø‡§¨‡§æ‡§∞"];
        
        const bsMonthDays = [[2000,30,32,31,32,31,30,30,30,29,30,29,31],[2001,31,31,32,31,31,31,30,29,30,29,30,30],[2002,31,31,32,32,31,30,30,29,30,29,30,30],[2003,31,32,31,32,31,30,30,30,29,29,30,31],[2004,30,32,31,32,31,30,30,30,29,30,29,31],[2005,31,31,32,31,31,31,30,29,30,29,30,30],[2006,31,31,32,32,31,30,30,29,30,29,30,30],[2007,31,32,31,32,31,30,30,30,29,29,30,31],[2008,31,31,31,32,31,31,29,30,30,29,29,31],[2009,31,31,32,31,31,31,30,29,30,29,30,30],[2010,31,31,32,32,31,30,30,29,30,29,30,30],[2011,31,32,31,32,31,30,30,30,29,29,30,31],[2012,31,31,31,32,31,31,29,30,30,29,30,30],[2013,31,31,32,31,31,31,30,29,30,29,30,30],[2014,31,31,32,32,31,30,30,29,30,29,30,30],[2015,31,32,31,32,31,30,30,30,29,29,30,31],[2016,31,31,31,32,31,31,29,30,30,29,30,30],[2017,31,31,32,31,31,31,30,29,30,29,30,30],[2018,31,32,31,32,31,30,30,29,30,29,30,30],[2019,31,32,31,32,31,30,30,30,29,30,29,31],[2020,31,31,31,32,31,31,30,29,30,29,30,30],[2021,31,31,32,31,31,31,30,29,30,29,30,30],[2022,31,32,31,32,31,30,30,30,29,29,30,30],[2023,31,32,31,32,31,30,30,30,29,30,29,31],[2024,31,31,31,32,31,31,30,29,30,29,30,30],[2025,31,31,32,31,31,31,30,29,30,29,30,30],[2026,31,32,31,32,31,30,30,30,29,29,30,31],[2027,30,32,31,32,31,30,30,30,29,30,29,31],[2028,31,31,32,31,31,31,30,29,30,29,30,30],[2029,31,31,32,31,32,30,30,29,30,29,30,30],[2030,31,32,31,32,31,30,30,30,29,29,30,31],[2031,30,32,31,32,31,30,30,30,29,30,29,31],[2032,31,31,32,31,31,31,30,29,30,29,30,30],[2033,31,31,32,32,31,30,30,29,30,29,30,30],[2034,31,32,31,32,31,30,30,30,29,29,30,31],[2035,30,32,31,32,31,31,29,30,30,29,29,31],[2036,31,31,32,31,31,31,30,29,30,29,30,30],[2037,31,31,32,32,31,30,30,29,30,29,30,30],[2038,31,32,31,32,31,30,30,30,29,29,30,31],[2039,31,31,31,32,31,31,29,30,30,29,30,30],[2040,31,31,32,31,31,31,30,29,30,29,30,30],[2041,31,31,32,32,31,30,30,29,30,29,30,30],[2042,31,32,31,32,31,30,30,30,29,29,30,31],[2043,31,31,31,32,31,31,29,30,30,29,30,30],[2044,31,31,32,31,31,31,30,29,30,29,30,30],[2045,31,32,31,32,31,30,30,29,30,29,30,30],[2046,31,32,31,32,31,30,30,30,29,29,30,31],[2047,31,31,31,32,31,31,30,29,30,29,30,30],[2048,31,31,32,31,31,31,30,29,30,29,30,30],[2049,31,32,31,32,31,30,30,30,29,29,30,30],[2050,31,32,31,32,31,30,30,30,29,30,29,31],[2051,31,31,31,32,31,31,30,29,30,29,30,30],[2052,31,31,32,31,31,31,30,29,30,29,30,30],[2053,31,32,31,32,31,30,30,30,29,29,30,30],[2054,31,32,31,32,31,30,30,30,29,30,29,31],[2055,31,31,32,31,31,31,30,29,30,29,30,30],[2056,31,31,32,31,32,30,30,29,30,29,30,30],[2057,31,32,31,32,31,30,30,30,29,29,30,31],[2058,30,32,31,32,31,30,30,30,29,30,29,31],[2059,31,31,32,31,31,31,30,29,30,29,30,30],[2060,31,31,32,32,31,30,30,29,30,29,30,30],[2061,31,32,31,32,31,30,30,30,29,29,30,31],[2062,30,32,31,32,31,31,29,30,29,30,29,31],[2063,31,31,32,31,31,31,30,29,30,29,30,30],[2064,31,31,32,32,31,30,30,29,30,29,30,30],[2065,31,32,31,32,31,30,30,30,29,29,30,31],[2066,31,31,31,32,31,31,29,30,30,29,29,31],[2067,31,31,32,31,31,31,30,29,30,29,30,30],[2068,31,31,32,32,31,30,30,29,30,29,30,30],[2069,31,32,31,32,31,30,30,30,29,29,30,31],[2070,31,31,31,32,31,31,29,30,30,29,30,30],[2071,31,31,32,31,31,31,30,29,30,29,30,30],[2072,31,32,31,32,31,30,30,29,30,29,30,30],[2073,31,32,31,32,31,30,30,30,29,29,30,31],[2074,31,31,31,32,31,31,30,29,30,29,30,30],[2075,31,31,32,31,31,31,30,29,30,29,30,30],[2076,31,32,31,32,31,30,30,30,29,29,30,30],[2077,31,32,31,32,31,30,30,30,29,30,29,31],[2078,31,31,31,32,31,31,30,29,30,29,30,30],[2079,31,31,32,31,31,31,30,29,30,29,30,30],[2080,31,32,31,32,31,30,30,30,29,29,30,30],[2081,31,32,31,32,31,30,30,30,29,30,29,31],[2082,31,31,32,31,31,31,30,29,30,29,30,30],[2083,31,31,32,31,32,30,30,29,30,29,30,30],[2084,31,32,31,32,31,30,30,30,29,29,30,31],[2085,30,32,31,32,31,30,30,30,29,30,29,31],[2086,31,31,32,31,31,31,30,29,30,29,30,30],[2087,31,31,32,32,31,30,30,29,30,29,30,30],[2088,31,32,31,32,31,30,30,30,29,29,30,31],[2089,30,32,31,32,31,31,29,30,30,29,29,31],[2090,31,31,32,31,31,31,30,29,30,29,30,30],[2091,31,31,32,32,31,30,30,29,30,29,30,30],[2092,31,32,31,32,31,30,30,30,29,29,30,31],[2093,31,31,31,32,31,31,29,30,30,29,30,30],[2094,31,31,32,31,31,31,30,29,30,29,30,30],[2095,31,32,31,32,31,30,30,29,30,29,30,30],[2096,31,32,31,32,31,30,30,30,29,29,30,31],[2097,31,31,31,32,31,31,30,29,30,29,30,30],[2098,31,31,32,31,31,31,30,29,30,29,30,30],[2099,31,32,31,32,31,30,30,30,29,29,30,30],[2100,31,32,31,32,31,30,30,30,29,30,29,31]];

        // Holidays
        const holidays = {
            "1-1": { name: "New Year's Day", nepali: "‡§®‡§Ø‡§æ‡§Å ‡§µ‡§∞‡•ç‡§∑", type: "International" },
            "1-14": { name: "Makar Sankranti", nepali: "‡§Æ‡§ï‡§∞ ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§æ‡§®‡•ç‡§§‡§ø", type: "Nepal" },
            "2-14": { name: "Valentine's Day", nepali: "‡§≠‡•ç‡§Ø‡§æ‡§≤‡•á‡§®‡•ç‡§ü‡§æ‡§á‡§® ‡§°‡•á", type: "International" },
            "2-19": { name: "Democracy Day", nepali: "‡§™‡•ç‡§∞‡§ú‡§æ‡§§‡§®‡•ç‡§§‡•ç‡§∞ ‡§¶‡§ø‡§µ‡§∏", type: "Nepal" },
            "3-8": { name: "Women's Day", nepali: "‡§Æ‡§π‡§ø‡§≤‡§æ ‡§¶‡§ø‡§µ‡§∏", type: "International" },
            "4-14": { name: "Nepali New Year", nepali: "‡§®‡•á‡§™‡§æ‡§≤‡•Ä ‡§®‡§Ø‡§æ‡§Å ‡§µ‡§∞‡•ç‡§∑", type: "Nepal" },
            "5-1": { name: "Labour Day", nepali: "‡§∂‡•ç‡§∞‡§Æ‡§ø‡§ï ‡§¶‡§ø‡§µ‡§∏", type: "International" },
            "5-29": { name: "Republic Day", nepali: "‡§ó‡§£‡§§‡§®‡•ç‡§§‡•ç‡§∞ ‡§¶‡§ø‡§µ‡§∏", type: "Nepal" },
            "9-19": { name: "Constitution Day", nepali: "‡§∏‡§Ç‡§µ‡§ø‡§ß‡§æ‡§® ‡§¶‡§ø‡§µ‡§∏", type: "Nepal" },
            "12-25": { name: "Christmas", nepali: "‡§ï‡•ç‡§∞‡§ø‡§∏‡§Æ‡§∏", type: "International" }
        };

        // Helper Functions
        function toNepaliNum(num) { 
            return String(num).split('').map(d => nepaliNums[parseInt(d)] || d).join(''); 
        }
        
        function adToBs(year, month, day) {
            const startAdDate = new Date(1943, 3, 14);
            const inputDate = new Date(year, month - 1, day);
            let totalDays = Math.floor((inputDate - startAdDate) / (1000 * 60 * 60 * 24)) + 1; // Fixed: Added +1
            let bsYear = 2000, bsMonth = 1, bsDay = 1;
            while (totalDays > 0) {
                const yearData = bsMonthDays.find(y => y[0] === bsYear);
                if (!yearData) break;
                const daysInMonth = yearData[bsMonth];
                if (totalDays > daysInMonth) { 
                    totalDays -= daysInMonth; 
                    bsMonth++; 
                    if (bsMonth > 12) { bsMonth = 1; bsYear++; } 
                } else { 
                    bsDay = totalDays; 
                    totalDays = 0; 
                }
            }
            return { year: bsYear, month: bsMonth, day: bsDay };
        }

        function getTodayWorkoutDay() { 
            return new Date().getDay() + 1; 
        }
        
        function getDateKey(date) { 
            date = date || new Date(); 
            return date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate(); 
        }

        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // State
        let currentDay = getTodayWorkoutDay();
        let currentCalendarDate = new Date();
        let completedSets = JSON.parse(localStorage.getItem('completedSets') || '{}');
        let completedDays = JSON.parse(localStorage.getItem('completedDays') || '{}');
        let exerciseWeights = JSON.parse(localStorage.getItem('exerciseWeights') || '{}');
        let weightHistory = JSON.parse(localStorage.getItem('weightHistory') || '{}');
        let personalRecords = JSON.parse(localStorage.getItem('personalRecords') || '{}');
        let creatineTracker = JSON.parse(localStorage.getItem('creatineTracker') || '{}');
        let totalXP = parseInt(localStorage.getItem('totalXP') || '0');
        let weightUnit = localStorage.getItem('weightUnit') || 'lbs';

        // Initialize
        function init() {
            updateDateDisplay();
            renderDayTabs();
            selectDay(getTodayWorkoutDay());
            updateCreatineButton();
            updateWeightUnitButtons();
            updateXPBar();
            updateQuickStats();
        }

        function updateDateDisplay() {
            const now = new Date();
            const englishDate = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            const bs = adToBs(now.getFullYear(), now.getMonth() + 1, now.getDate());
            const nepaliDate = toNepaliNum(bs.day) + ' ' + nepaliMonths[bs.month - 1] + ' ' + toNepaliNum(bs.year);
            document.getElementById('englishDate').textContent = englishDate;
            document.getElementById('nepaliDate').textContent = nepaliDate;
        }

        function renderDayTabs() {
            const container = document.getElementById('dayTabs');
            const todayDay = getTodayWorkoutDay();
            let html = '';
            for (let day = 1; day <= 7; day++) {
                const isToday = day === todayDay;
                const isActive = day === currentDay;
                let classes = 'day-chip';
                if (isActive) classes += ' active';
                if (isToday && !isActive) classes += ' today';
                html += `<div onclick="selectDay(${day})" class="${classes}" data-day="${day}">
                    <div class="day-number">${day}</div>
                    <div class="day-name">${shortDayNames[day - 1]}</div>
                    <div class="day-nepali">${nepaliDayNames[day - 1]}</div>
                </div>`;
            }
            container.innerHTML = html;
        }

        function showView(view) {
            document.getElementById('workout-view').classList.add('hidden');
            document.getElementById('calendar-view').classList.add('hidden');
            document.getElementById('stats-view').classList.add('hidden');
            document.getElementById(view + '-view').classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('nav-' + view).classList.add('active');
            if (view === 'stats') updateStats();
            if (view === 'calendar') renderCalendar();
        }

        function selectDay(day) {
            currentDay = day;
            renderDayTabs();
            const data = workoutData[day];
            document.getElementById('workoutDayLabel').textContent = `Day ${day} ‚Ä¢ ${data.nepaliDay}`;
            document.getElementById('currentDayTitle').textContent = data.title;
            document.getElementById('currentDayFocus').textContent = data.focus;
            renderExercises();
            updateProgress();
            updateQuickStats();
        }

        function renderExercises() {
            const list = document.getElementById('exerciseList');
            const data = workoutData[currentDay];
            const dateKey = getDateKey();
            const dayKey = dateKey + '-day' + currentDay;
            if (!completedSets[dayKey]) completedSets[dayKey] = {};
            if (!exerciseWeights[dayKey]) exerciseWeights[dayKey] = {};
            
            list.innerHTML = data.exercises.map((ex, exIndex) => {
                const exKey = 'ex' + exIndex;
                const exId = `day${currentDay}-${exKey}`;
                if (!completedSets[dayKey][exKey]) completedSets[dayKey][exKey] = {};
                
                const completedCount = Object.values(completedSets[dayKey][exKey]).filter(Boolean).length;
                const isCompleted = completedCount === ex.sets;
                const currentWeight = exerciseWeights[dayKey][exKey] || 0;
                const pr = personalRecords[exId] || 0;
                const lastWeight = getLastWeight(exId);
                
                // Generate set checkboxes
                let setsHtml = '';
                for (let s = 0; s < ex.sets; s++) {
                    const setKey = 'set' + s;
                    const isSetDone = completedSets[dayKey][exKey][setKey] || false;
                    setsHtml += `
                        <div class="set-item">
                            <input type="checkbox" class="set-checkbox" ${isSetDone ? 'checked' : ''} 
                                onchange="toggleSet(${exIndex}, ${s}, this.checked)">
                            <div class="set-info">
                                <div class="set-label">Set ${s + 1}</div>
                                <div class="set-reps">${ex.reps}</div>
                            </div>
                        </div>`;
                }
                
                // Weight controls
                let weightHtml = '';
                if (ex.trackWeight) {
                    const overloadClass = currentWeight > lastWeight ? 'up' : (currentWeight < lastWeight ? 'down' : 'same');
                    const overloadIcon = currentWeight > lastWeight ? '‚Üë' : (currentWeight < lastWeight ? '‚Üì' : '=');
                    const overloadText = lastWeight > 0 ? `${overloadIcon} Last: ${lastWeight} ${weightUnit}` : 'First time!';
                    
                    weightHtml = `
                        <div class="weight-row">
                            <span class="weight-label">Weight</span>
                            <div class="weight-controls">
                                <button class="weight-btn" onclick="adjustWeight(${exIndex}, -2.5)">‚àí</button>
                                <div class="weight-display">${currentWeight} ${weightUnit}</div>
                                <button class="weight-btn" onclick="adjustWeight(${exIndex}, 2.5)">+</button>
                            </div>
                        </div>
                        <div class="overload-indicator ${overloadClass}">
                            üìà ${overloadText}
                        </div>`;
                }
                
                return `
                    <div class="exercise-card ${isCompleted ? 'completed' : ''}">
                        <div class="exercise-header">
                            <div class="exercise-info">
                                <span class="muscle-tag">${ex.muscle}</span>
                                <h4 class="exercise-name">${ex.name}</h4>
                                ${ex.note ? `<p class="exercise-note">${ex.note}</p>` : ''}
                            </div>
                            ${ex.trackWeight ? `<div class="pr-badge ${pr > 0 ? '' : 'no-pr'}">üèÖ PR: ${pr > 0 ? pr + ' ' + weightUnit : '--'}</div>` : ''}
                        </div>
                        <div class="sets-grid">${setsHtml}</div>
                        ${weightHtml}
                    </div>`;
            }).join('');
        }

        function getLastWeight(exId) {
            const history = weightHistory[exId] || [];
            if (history.length > 0) {
                return history[history.length - 1].weight;
            }
            return 0;
        }

        function toggleSet(exIndex, setIndex, completed) {
            const dateKey = getDateKey();
            const dayKey = dateKey + '-day' + currentDay;
            const exKey = 'ex' + exIndex;
            const setKey = 'set' + setIndex;
            
            if (!completedSets[dayKey]) completedSets[dayKey] = {};
            if (!completedSets[dayKey][exKey]) completedSets[dayKey][exKey] = {};
            
            const wasCompleted = completedSets[dayKey][exKey][setKey];
            completedSets[dayKey][exKey][setKey] = completed;
            localStorage.setItem('completedSets', JSON.stringify(completedSets));
            
            // XP System
            if (completed && !wasCompleted) {
                totalXP += 5;
            } else if (!completed && wasCompleted) {
                totalXP = Math.max(0, totalXP - 5);
            }
            localStorage.setItem('totalXP', totalXP);
            updateXPBar();
            
            renderExercises();
            updateProgress();
            updateQuickStats();
            checkDayCompletion();
            checkAndUpdatePR(exIndex);
        }

        function adjustWeight(exIndex, delta) {
            const dateKey = getDateKey();
            const dayKey = dateKey + '-day' + currentDay;
            const exKey = 'ex' + exIndex;
            const exId = `day${currentDay}-${exKey}`;
            
            if (!exerciseWeights[dayKey]) exerciseWeights[dayKey] = {};
            const current = exerciseWeights[dayKey][exKey] || 0;
            const newWeight = Math.max(0, current + delta);
            exerciseWeights[dayKey][exKey] = newWeight;
            localStorage.setItem('exerciseWeights', JSON.stringify(exerciseWeights));
            
            renderExercises();
        }

        function checkAndUpdatePR(exIndex) {
            const dateKey = getDateKey();
            const dayKey = dateKey + '-day' + currentDay;
            const exKey = 'ex' + exIndex;
            const exId = `day${currentDay}-${exKey}`;
            const exercise = workoutData[currentDay].exercises[exIndex];
            
            if (!exercise.trackWeight) return;
            
            const currentWeight = exerciseWeights[dayKey]?.[exKey] || 0;
            const allSetsCompleted = Object.values(completedSets[dayKey]?.[exKey] || {}).filter(Boolean).length === exercise.sets;
            
            if (allSetsCompleted && currentWeight > 0) {
                const currentPR = personalRecords[exId] || 0;
                if (currentWeight > currentPR) {
                    personalRecords[exId] = currentWeight;
                    localStorage.setItem('personalRecords', JSON.stringify(personalRecords));
                    showToast(`üèÖ NEW PR! ${exercise.name}: ${currentWeight} ${weightUnit}`, 'success');
                }
                
                // Save to history
                if (!weightHistory[exId]) weightHistory[exId] = [];
                weightHistory[exId].push({ date: dateKey, weight: currentWeight });
                localStorage.setItem('weightHistory', JSON.stringify(weightHistory));
            }
        }

        function setWeightUnit(unit) {
            weightUnit = unit;
            localStorage.setItem('weightUnit', unit);
            updateWeightUnitButtons();
            renderExercises();
        }

        function updateWeightUnitButtons() {
            document.getElementById('unitLbs').classList.toggle('active', weightUnit === 'lbs');
            document.getElementById('unitKg').classList.toggle('active', weightUnit === 'kg');
        }

        function toggleCreatine() {
            const dateKey = getDateKey();
            const wasTaken = creatineTracker[dateKey] || false;
            creatineTracker[dateKey] = !creatineTracker[dateKey];
            localStorage.setItem('creatineTracker', JSON.stringify(creatineTracker));
            updateCreatineButton();
            
            if (creatineTracker[dateKey] && !wasTaken) {
                totalXP += 10;
            } else if (!creatineTracker[dateKey] && wasTaken) {
                totalXP = Math.max(0, totalXP - 10);
            }
            localStorage.setItem('totalXP', totalXP);
            updateXPBar();
        }

        function updateCreatineButton() {
            const dateKey = getDateKey();
            const btn = document.getElementById('creatineBtn');
            const taken = creatineTracker[dateKey];
            btn.textContent = taken ? '‚úì TAKEN' : 'NOT TAKEN';
            btn.classList.toggle('taken', taken);
        }

        function updateXPBar() {
            const level = Math.floor(totalXP / 100) + 1;
            const currentLevelXP = totalXP % 100;
            const percentage = (currentLevelXP / 100) * 100;
            document.getElementById('userLevel').textContent = level;
            document.getElementById('currentXP').textContent = currentLevelXP;
            document.getElementById('nextLevelXP').textContent = 100;
            document.getElementById('xpFill').style.width = percentage + '%';
        }

        function updateProgress() {
            const dateKey = getDateKey();
            const dayKey = dateKey + '-day' + currentDay;
            const exercises = workoutData[currentDay].exercises;
            
            let totalSetsCount = 0;
            let completedCount = 0;
            
            exercises.forEach((ex, exIndex) => {
                totalSetsCount += ex.sets;
                const exKey = 'ex' + exIndex;
                if (completedSets[dayKey] && completedSets[dayKey][exKey]) {
                    completedCount += Object.values(completedSets[dayKey][exKey]).filter(Boolean).length;
                }
            });
            
            const percentage = Math.round((completedCount / totalSetsCount) * 100);
            const circumference = 2 * Math.PI * 30;
            const offset = circumference - (percentage / 100) * circumference;
            document.getElementById('progressCircle').style.strokeDashoffset = offset;
            document.getElementById('progressText').textContent = percentage + '%';
        }

        function updateQuickStats() {
            const dateKey = getDateKey();
            const dayKey = dateKey + '-day' + currentDay;
            const exercises = workoutData[currentDay].exercises;
            
            let totalSetsCount = 0;
            let completedSetsCount = 0;
            let completedExCount = 0;
            
            exercises.forEach((ex, exIndex) => {
                totalSetsCount += ex.sets;
                const exKey = 'ex' + exIndex;
                const setsCompleted = Object.values(completedSets[dayKey]?.[exKey] || {}).filter(Boolean).length;
                completedSetsCount += setsCompleted;
                if (setsCompleted === ex.sets) completedExCount++;
            });
            
            document.getElementById('todaySets').textContent = `${completedSetsCount}/${totalSetsCount}`;
            document.getElementById('todayExercises').textContent = `${completedExCount}/${exercises.length}`;
            
            // Streak
            let streak = 0;
            const today = new Date();
            for (let i = 0; i < 365; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(checkDate.getDate() - i);
                const checkKey = getDateKey(checkDate);
                if (completedDays[checkKey]) streak++;
                else if (i > 0) break;
            }
            document.getElementById('streakCount').textContent = streak + 'üî•';
        }

        function checkDayCompletion() {
            const dateKey = getDateKey();
            const dayKey = dateKey + '-day' + currentDay;
            const exercises = workoutData[currentDay].exercises;
            
            let totalSetsCount = 0;
            let completedCount = 0;
            
            exercises.forEach((ex, exIndex) => {
                totalSetsCount += ex.sets;
                const exKey = 'ex' + exIndex;
                if (completedSets[dayKey] && completedSets[dayKey][exKey]) {
                    completedCount += Object.values(completedSets[dayKey][exKey]).filter(Boolean).length;
                }
            });
            
            if (completedCount === totalSetsCount && !completedDays[dateKey]) {
                completedDays[dateKey] = currentDay;
                localStorage.setItem('completedDays', JSON.stringify(completedDays));
                totalXP += 50;
                localStorage.setItem('totalXP', totalXP);
                updateXPBar();
                showToast('üéâ Workout Complete! +50 XP', 'success');
            }
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            const bs = adToBs(year, month + 1, 15);
            
            document.getElementById('calendarMonth').textContent = new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' }).toUpperCase();
            document.getElementById('calendarNepaliMonth').textContent = nepaliMonthsEng[bs.month - 1] + ' ' + bs.year;
            
            let html = '';
            let monthHolidays = [];
            
            for (let i = 0; i < firstDay; i++) html += '<div class="calendar-day" style="opacity: 0;"></div>';
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateKey = year + '-' + (month + 1) + '-' + day;
                const holidayKey = (month + 1) + '-' + day;
                const isToday = date.toDateString() === today.toDateString();
                const isCompleted = completedDays[dateKey];
                const holiday = holidays[holidayKey];
                
                if (holiday) monthHolidays.push({ day, ...holiday });
                
                let classes = 'calendar-day';
                if (isToday) classes += ' today';
                else if (isCompleted) classes += ' completed-day';
                if (holiday) classes += ' holiday';
                
                html += `<div class="${classes}">${day}</div>`;
            }
            grid.innerHTML = html;
            
            // Holidays list
            const holidayList = document.getElementById('holidayList');
            const holidayCard = document.getElementById('holidayCard');
            if (monthHolidays.length > 0) {
                holidayCard.style.display = 'block';
                holidayList.innerHTML = monthHolidays.map(h => `
                    <div class="holiday-item">
                        <span class="holiday-name">${h.day}: ${h.nepali} <span>(${h.name})</span></span>
                        <span class="holiday-type ${h.type === 'Nepal' ? 'nepal' : ''}">${h.type}</span>
                    </div>`).join('');
            } else {
                holidayCard.style.display = 'none';
            }
        }

        function changeMonth(delta) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            renderCalendar();
        }

        function updateStats() {
            const totalWorkouts = Object.keys(completedDays).length;
            
            let totalSetsCompleted = 0;
            Object.values(completedSets).forEach(day => {
                Object.values(day).forEach(ex => {
                    totalSetsCompleted += Object.values(ex).filter(Boolean).length;
                });
            });
            
            const creatineDaysCount = Object.values(creatineTracker).filter(Boolean).length;
            
            let streak = 0;
            const today = new Date();
            for (let i = 0; i < 365; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(checkDate.getDate() - i);
                const dateKey = getDateKey(checkDate);
                if (completedDays[dateKey]) streak++;
                else if (i > 0) break;
            }
            
            document.getElementById('totalWorkouts').textContent = totalWorkouts;
            document.getElementById('currentStreak').textContent = streak;
            document.getElementById('totalSets').textContent = totalSetsCompleted;
            document.getElementById('creatineDays').textContent = creatineDaysCount;
            
            // Weekly overview
            const weekStart = new Date(today);
            weekStart.setDate(weekStart.getDate() - weekStart.getDay());
            
            let weeklyHtml = '';
            for (let i = 0; i < 7; i++) {
                const checkDate = new Date(weekStart);
                checkDate.setDate(checkDate.getDate() + i);
                const dateKey = getDateKey(checkDate);
                const isCompleted = completedDays[dateKey];
                
                weeklyHtml += `
                    <div class="weekly-day">
                        <div class="weekly-day-box ${isCompleted ? 'completed' : ''}">${isCompleted ? '‚úì' : shortDayNames[i][0]}</div>
                        <div class="weekly-day-label">${nepaliDayNames[i]}</div>
                    </div>`;
            }
            document.getElementById('weeklyDays').innerHTML = weeklyHtml;
            
            // PR List
            const prList = document.getElementById('prList');
            const prEntries = Object.entries(personalRecords).filter(([_, weight]) => weight > 0);
            if (prEntries.length > 0) {
                prList.innerHTML = prEntries.map(([exId, weight]) => {
                    const [dayPart, exPart] = exId.split('-');
                    const dayNum = parseInt(dayPart.replace('day', ''));
                    const exNum = parseInt(exPart.replace('ex', ''));
                    const exercise = workoutData[dayNum]?.exercises[exNum];
                    return `
                        <div class="pr-item">
                            <span class="pr-exercise">${exercise?.name || exId}</span>
                            <span class="pr-weight">${weight} ${weightUnit}</span>
                        </div>`;
                }).join('');
            } else {
                prList.innerHTML = '<div class="pr-item"><span class="pr-exercise">No PRs yet. Start lifting! üí™</span></div>';
            }
        }

        function exportData() {
            const data = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                appName: "Kritik's Gurkha Gains",
                completedSets,
                completedDays,
                exerciseWeights,
                weightHistory,
                personalRecords,
                creatineTracker,
                totalXP,
                weightUnit
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `gurkha-gains-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('üì§ Data exported successfully!', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.completedSets) { completedSets = data.completedSets; localStorage.setItem('completedSets', JSON.stringify(completedSets)); }
                    if (data.completedDays) { completedDays = data.completedDays; localStorage.setItem('completedDays', JSON.stringify(completedDays)); }
                    if (data.exerciseWeights) { exerciseWeights = data.exerciseWeights; localStorage.setItem('exerciseWeights', JSON.stringify(exerciseWeights)); }
                    if (data.weightHistory) { weightHistory = data.weightHistory; localStorage.setItem('weightHistory', JSON.stringify(weightHistory)); }
                    if (data.personalRecords) { personalRecords = data.personalRecords; localStorage.setItem('personalRecords', JSON.stringify(personalRecords)); }
                    if (data.creatineTracker) { creatineTracker = data.creatineTracker; localStorage.setItem('creatineTracker', JSON.stringify(creatineTracker)); }
                    if (data.totalXP !== undefined) { totalXP = data.totalXP; localStorage.setItem('totalXP', totalXP); }
                    if (data.weightUnit) { weightUnit = data.weightUnit; localStorage.setItem('weightUnit', weightUnit); }
                    
                    init();
                    showToast('üì• Data imported successfully!', 'success');
                } catch (err) {
                    showToast('‚ùå Invalid backup file!', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function resetAllData() {
            if (confirm('‚ö†Ô∏è ‡§Ø‡•ã ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§≤‡•á ‡§∏‡§¨‡•à ‡§°‡§æ‡§ü‡§æ ‡§Æ‡•á‡§ü‡§æ‡§â‡§®‡•á‡§õ! Are you sure?')) {
                localStorage.clear();
                completedSets = {};
                completedDays = {};
                exerciseWeights = {};
                weightHistory = {};
                personalRecords = {};
                creatineTracker = {};
                totalXP = 0;
                init();
                showToast('üóëÔ∏è All data reset!', 'success');
            }
        }

        // PWA Install
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', e => {
            e.preventDefault();
            deferredPrompt = e;
            const dismissed = localStorage.getItem('installDismissed');
            if (!dismissed || Date.now() - parseInt(dismissed) > 7 * 24 * 60 * 60 * 1000) {
                document.getElementById('installBanner').classList.remove('hidden');
                setTimeout(() => document.getElementById('installBanner').classList.add('show'), 100);
            }
        });

        function installApp() {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then(() => {
                deferredPrompt = null;
                document.getElementById('installBanner').classList.add('hidden');
            });
        }

        function dismissInstall() {
            document.getElementById('installBanner').classList.remove('show');
            setTimeout(() => document.getElementById('installBanner').classList.add('hidden'), 300);
            localStorage.setItem('installDismissed', Date.now().toString());
        }

        // Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(err => console.log('SW Error:', err));
        }

        init();
    </script>
</body>
</html>
